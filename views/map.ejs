<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>육림고개</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <!-- kakao map api 불러오기 -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f377132bd5893a18c51e169c8ab7a99b"></script>
    <!-- services와 clusterer, drawing 라이브러리 불러오기 -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f377132bd5893a18c51e169c8ab7a99b&libraries=services,clusterer,drawing"></script>
    <link href="css/rating.css" rel="stylesheet">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="/">춘천</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/map">육림고개</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/about">about</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

    <div id="map" style="width:100%;height:1000px;"></div>

    <script>
      var mapContainer = document.getElementById('map');// 지도를 표시할 div 
      var mapOption = { 
        center: new kakao.maps.LatLng(37.877388, 127.729054), // 지도의 중심좌표
        level: 1 // 지도의 확대 레벨
      };
      // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
      var map = new kakao.maps.Map(mapContainer, mapOption);
      function setDragZoomable(able) {
        // 마우스 드래그로 지도 이동 가능여부를 설정합니다
        map.setDraggable(able);   
        map.setZoomable(able);     
      }
      var inn_polygon = new kakao.maps.Polygon({
        map: map,
          path: [
              new kakao.maps.LatLng(37.877846, 127.729500),
              new kakao.maps.LatLng(37.877757, 127.729596),
              new kakao.maps.LatLng(37.877777, 127.729632),
              new kakao.maps.LatLng(37.877890, 127.729590)
          ],
          fillColor: '#CFE7FF', // 채우기 색깔입니다
          fillOpacity: 0.5, // 채우기 불투명도 입니다
          strokeWeight: 2,
          strokeColor: '#CFE7FF',
          strokeOpacity: 0.7,
          strokeStyle: 'line',
          clickable: true
      });

      var inn_content =`<% var store_name = 'store_inn'; %>
        <div class="card" style="width: 500px;">
            <div>
            <form action="/add" method="POST">
                <input type="hidden" id="StoreName" name="name" value=<%=store_name %>>
                <div class="mb-2">
                    <label for="exampleInputPassword1" class="rating-label">
                        <div id="ratingHelp" class="form-text">별점을 남겨주세요</div>
                        <input class="rating rating--nojs" style="--starsize:2rem;" name="rating" max="5" step="0.1" type="range" value="3">
                    </label>
                </div>
                <div class="mb-2">
                    <div id="reviewHelp" class="form-text">리뷰를 적어주세요</div>
                    <input class="form-control" name="review" id="inputReview" aria-describedby="reviewHelp">
                </div>
                <div class="position-absolute top-0 end-0"">
                    <div style="margin:10px;">
                        <button type="submit" class="btn btn-primary">Submit</button>
                        <button type="button" onclick="close_overlay(innOverlay)" class="btn btn-danger">Close</button>
                    </div>
                </div>
            </form>
            </div>
            <div style="height: 200px; overflow-y: scroll;">
                <table class="table" style="width: 500px;">
                    <thead>
                        <tr>
                            <th scope="col">rating</th>
                            <th scope="col">review</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% console.log(loginfo.length) %>
                        <% for (var i=0; i < loginfo.length; i ++) { %>
                        <% if(loginfo[i].name == store_name){ %>
                            <tr>
                                <td><input class="rating" max="5" step="0.01"
                                    style=<%= "--fill:#777;--starsize:1rem;--value:" + loginfo[i].rating%>
                                    type="range" value=<%= loginfo[i].rating%> ></td>
                                <td><%= loginfo[i].content %></td>
                            </tr>
                        <% } %>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>`;

      // 커스텀 오버레이를 생성합니다
      var position = new kakao.maps.LatLng(37.877846, 127.729500);
      var innOverlay = new kakao.maps.CustomOverlay({
          position: position,
          content: inn_content,
          xAnchor: 0.3,
          yAnchor: 0.91
      });
      var mouseoverOption = { 
        fillColor: '#EFFFED', // 채우기 색깔입니다
        fillOpacity: 0.8 // 채우기 불투명도 입니다        
      };
      // 다각형에 마우스아웃 이벤트가 발생했을 때 변경할 채우기 옵션입니다
      var mouseoutOption = {
        fillColor: '#CFE7FF', // 채우기 색깔입니다 
        fillOpacity: 0.7 // 채우기 불투명도 입니다        
      };
      function close_overlay(customOverlay) {
        customOverlay.setMap();
      }
      kakao.maps.event.addListener(inn_polygon, 'click', function() {
        innOverlay.setMap(map);
        console.log('click');  
      });
      kakao.maps.event.addListener(inn_polygon, 'mouseover', function() {   
        inn_polygon.setOptions(mouseoverOption);
      });
      kakao.maps.event.addListener(inn_polygon, 'mouseout', function() {
        inn_polygon.setOptions(mouseoutOption);
      });
    //   window.onload = function(){
    //     map.setDraggable(false);
    //     map.setZoomable(false);
    //   };
    </script>
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
  </body>
</html>